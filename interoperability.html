<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="img/icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="img/icon.ico">
  <title>interoperability</title>
  <meta name="title" content="interoperability" />
  <meta name="description" content="the vv language" />
  <meta name="keywords" content="vv" />

  <link rel="stylesheet" href="css/theme.css">
  <link rel="stylesheet" href="css/highlight.css">
  <link rel="stylesheet" href="css/site.css">
  <link rel="stylesheet" href="css/board.css">
  <script src="js/highlight.js"></script>
  <script src="js/live.js"></script>
  <script src="js/umbrella.js"></script>

</head>

<body>
<nav>
  <a id="brand" href="./">VV</a>
  <a href="./release.html">RELEASE</a>
  <a href="https://github.com/malivvan/vv">SOURCE</a>
</nav>
<header>
  <h1>interoperability</h1>
</header>
<article><h2 id="table-of-contents">Table of Contents <a class="anchor" href="#table-of-contents"> </a></h2>
<ul>
<li><a href="#using-scripts">Using Scripts</a>
<ul>
<li><a href="#type-conversion-table">Type Conversion Table</a></li>
<li><a href="#user-types">User Types</a></li>
</ul>
</li>
<li><a href="#sandbox-environments">Sandbox Environments</a></li>
<li><a href="#concurrency">Concurrency</a></li>
<li><a href="#compiler-and-vm">Compiler and VM</a></li>
</ul>
<h2 id="using-scripts">Using Scripts <a class="anchor" href="#using-scripts"> </a></h2>
<p>Embedding and executing the VV code in Go is very easy. At a high level,
this process is like:</p>
<ul>
<li>create a <a href="https://godoc.org/github.com/malivvan/vv#Script">Script</a> instance with
your code,</li>
<li><em>optionally</em> add some
<a href="https://godoc.org/github.com/malivvan/vv#Variable">Script Variables</a> to Script,</li>
<li>compile or directly run the script,</li>
<li>retrieve <em>output</em> values from the
<a href="https://godoc.org/github.com/malivvan/vv#Compiled">Compiled</a> instance.</li>
</ul>
<p>The following is an example where a VV script is compiled and run with no
input/output variables.</p>
<pre><code class="language-golang">import &quot;github.com/malivvan/vv/vvm&quot;

var code = `
reduce := func(seq, fn) {
    s := 0
    for x in seq { fn(x, s) }
    return s
}

print(reduce([1, 2, 3], func(x, s) { s += x }))
`

func main() {
    s := vv.NewScript([]byte(code))
    if _, err := s.Run(); err != nil {
        panic(err)
    }
}
</code></pre>
<p>Here&rsquo;s another example where an input variable is added to the script, and, an
output variable is accessed through
<a href="https://godoc.org/github.com/malivvan/vv#Variable.Int">Variable.Int</a> function:</p>
<pre><code class="language-golang">import (
    &quot;fmt&quot;

    &quot;github.com/malivvan/vv/vvm&quot;
)

func main() {
    s := vv.NewScript([]byte(`a := b + 20`))

    // define variable 'b'
    _ = s.Add(&quot;b&quot;, 10)

    // compile the source
    c, err := s.Compile()
    if err != nil {
        panic(err)
    }

    // run the compiled bytecode
    // a compiled bytecode 'c' can be executed multiple times without re-compiling it
    if err := c.Run(); err != nil {
        panic(err)
    }

    // retrieve value of 'a'
    a := c.Get(&quot;a&quot;)
    fmt.Println(a.Int())           // prints &quot;30&quot;

    // re-run after replacing value of 'b'
    if err := c.Set(&quot;b&quot;, 20); err != nil {
        panic(err)
    }
    if err := c.Run(); err != nil {
        panic(err)
    }
    fmt.Println(c.Get(&quot;a&quot;).Int())  // prints &quot;40&quot;
}
</code></pre>
<p>A variable <code>b</code> is defined by the user before compilation using
<a href="https://godoc.org/github.com/malivvan/vv#Script.Add">Script.Add</a> function. Then a
compiled bytecode <code>c</code> is used to execute the bytecode and get the value of
global variables. In this example, the value of global variable <code>a</code> is read
using <a href="https://godoc.org/github.com/malivvan/vv#Compiled.Get">Compiled.Get</a>
function. See
<a href="https://godoc.org/github.com/malivvan/vv#Variable">documentation</a> for the
full list of variable value functions.</p>
<p>Value of the global variables can be replaced using
<a href="https://godoc.org/github.com/malivvan/vv#Compiled.Set">Compiled.Set</a> function.
But it will return an error if you try to set the value of un-defined global
variables <em>(e.g. trying to set the value of <code>x</code> in the example)</em>.</p>
<h3 id="type-conversion-table">Type Conversion Table <a class="anchor" href="#type-conversion-table"> </a></h3>
<p>When adding a Variable
<em>(<a href="https://godoc.org/github.com/malivvan/vv#Script.Add">Script.Add</a>)</em>, Script
converts Go values into VV values based on the following conversion table.</p>
<table>
<thead>
<tr>
<th align="left">Go Type</th>
<th align="left">VV Type</th>
<th align="left">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>nil</code></td>
<td align="left"><code>Undefined</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>string</code></td>
<td align="left"><code>String</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>int64</code></td>
<td align="left"><code>Int</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>int</code></td>
<td align="left"><code>Int</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>bool</code></td>
<td align="left"><code>Bool</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>rune</code></td>
<td align="left"><code>Char</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>byte</code></td>
<td align="left"><code>Char</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>float64</code></td>
<td align="left"><code>Float</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>[]byte</code></td>
<td align="left"><code>Bytes</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>time.Time</code></td>
<td align="left"><code>Time</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>error</code></td>
<td align="left"><code>Error{String}</code></td>
<td align="left">use <code>error.Error()</code> as String value</td>
</tr>
<tr>
<td align="left"><code>map[string]Object</code></td>
<td align="left"><code>Map</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>map[string]interface{}</code></td>
<td align="left"><code>Map</code></td>
<td align="left">individual elements converted to VV objects</td>
</tr>
<tr>
<td align="left"><code>[]Object</code></td>
<td align="left"><code>Array</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>[]interface{}</code></td>
<td align="left"><code>Array</code></td>
<td align="left">individual elements converted to VV objects</td>
</tr>
<tr>
<td align="left"><code>Object</code></td>
<td align="left"><code>Object</code></td>
<td align="left"><em>(no type conversion performed)</em></td>
</tr>
</tbody>
</table>
<h3 id="user-types">User Types <a class="anchor" href="#user-types"> </a></h3>
<p>Users can add and use a custom user type in VV code by implementing
<a href="https://godoc.org/github.com/malivvan/vv#Object">Object</a> interface. VV runtime
will treat the user types in the same way it does to the runtime types with no
performance overhead. See
<a href="https://github.com/malivvan/vv/blob/master/docs/objects.md">Object Types</a> for
more details.</p>
<h2 id="sandbox-environments">Sandbox Environments <a class="anchor" href="#sandbox-environments"> </a></h2>
<p>To securely compile and execute <em>potentially</em> unsafe script code, you can use
the following Script functions.</p>
<h3 id="scriptsetimportsmodules-objectsmodulemap">Script.SetImports(modules *objects.ModuleMap) <a class="anchor" href="#scriptsetimportsmodules-objectsmodulemap"> </a></h3>
<p>SetImports sets the import modules with corresponding names. Script <strong>does not</strong>
include any modules by default. You can use this function to include the
<a href="https://github.com/malivvan/vv/blob/master/docs/stdlib.md">Standard Library</a>.</p>
<pre><code class="language-golang">s := vv.NewScript([]byte(`math := import(&quot;math&quot;); a := math.abs(-19.84)`))

s.SetImports(stdlib.GetModuleMap(&quot;math&quot;))
// or, to include all stdlib at once
s.SetImports(stdlib.GetModuleMap(stdlib.AllModuleNames()...))
</code></pre>
<p>You can also include VV&rsquo;s written module using <code>objects.SourceModule</code>
(which implements <code>objects.Importable</code>).</p>
<pre><code class="language-golang">s := vv.NewScript([]byte(`double := import(&quot;double&quot;); a := double(20)`))

mods := vv.NewModuleMap()
mods.AddSourceModule(&quot;double&quot;, []byte(`export func(x) { return x * 2 }`))
s.SetImports(mods)
</code></pre>
<h3 id="scriptsetmaxallocsn-int64">Script.SetMaxAllocs(n int64) <a class="anchor" href="#scriptsetmaxallocsn-int64"> </a></h3>
<p>SetMaxAllocs sets the maximum number of object allocations. Note this is a
cumulative metric that tracks only the object creations. Set this to a negative
number (e.g. <code>-1</code>) if you don&rsquo;t need to limit the number of allocations.</p>
<h3 id="scriptenablefileimportenable-bool">Script.EnableFileImport(enable bool) <a class="anchor" href="#scriptenablefileimportenable-bool"> </a></h3>
<p>EnableFileImport enables or disables module loading from the local files. It&rsquo;s
disabled by default.</p>
<h3 id="vvmaxstringlen">vv.MaxStringLen <a class="anchor" href="#vvmaxstringlen"> </a></h3>
<p>Sets the maximum byte-length of string values. This limit applies to all
running VM instances in the process. Also it&rsquo;s not recommended to set or update
this value while any VM is executing.</p>
<h3 id="vvmaxbyteslen">vv.MaxBytesLen <a class="anchor" href="#vvmaxbyteslen"> </a></h3>
<p>Sets the maximum length of bytes values. This limit applies to all running VM
instances in the process. Also it&rsquo;s not recommended to set or update this value
while any VM is executing.</p>
<h2 id="concurrency">Concurrency <a class="anchor" href="#concurrency"> </a></h2>
<p>A compiled script (<code>Compiled</code>) can be used to run the code multiple
times by a goroutine. If you want to run the compiled script by multiple
goroutine, you should use <code>Compiled.Clone</code> function to make a copy of Compiled
instances.</p>
<h3 id="compiledclone">Compiled.Clone() <a class="anchor" href="#compiledclone"> </a></h3>
<p>Clone creates a new copy of Compiled instance. Cloned copies are safe for
concurrent use by multiple goroutines.</p>
<pre><code class="language-golang">for i := 0; i &lt; concurrency; i++ {
    go func(compiled *vv.Compiled) {
        // inputs
        _ = compiled.Set(&quot;a&quot;, rand.Intn(10))
        _ = compiled.Set(&quot;b&quot;, rand.Intn(10))
        _ = compiled.Set(&quot;c&quot;, rand.Intn(10))

        if err := compiled.Run(); err != nil {
            panic(err)
        }

        // outputs
        d = compiled.Get(&quot;d&quot;).Int()
        e = compiled.Get(&quot;e&quot;).Int()
    }(compiled.Clone()) // Pass the cloned copy of Compiled
}
</code></pre>
<h2 id="compiler-and-vm">Compiler and VM <a class="anchor" href="#compiler-and-vm"> </a></h2>
<p>Although it&rsquo;s not recommended, you can directly create and run the VV
<a href="https://godoc.org/github.com/malivvan/vv#Compiler">Compiler</a>, and
<a href="https://godoc.org/github.com/malivvan/vv#VM">VM</a> for yourself instead of using
Scripts and Script Variables. It&rsquo;s a bit more involved as you have to manage
the symbol tables and global variables between them, but, basically that&rsquo;s what
Script and Script Variable is doing internally.</p>
<p><em>TODO: add more information here</em></p>
</article>
<footer>
  <div style="float: left;">Copyright &copy; malivvan</div>
  <div style="float: right;">Last modified <time datetime="2025-08-03T20:53:46Z+00:00
">Sun Aug  3 20:53:46 UTC 2025
</time></div>
</footer>
<script>
  hljs.highlightAll();
</script>
</body>

</html>